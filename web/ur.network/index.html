<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" sizes="any" href="/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
    <link rel="icon" type="image/png" sizes="128x128" href="/favicon-128.png">
    <link rel="icon" type="image/png" sizes="180x180" href="/favicon-180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/favicon.png">
    <link rel="apple-touch-icon" type="image/png" sizes="192x192" href="/apple-touch-icon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URnetwork</title>
    <style>
        @font-face {
            font-family: 'PP Neue Bit';
            src: url('PPNeueBit-Bold.woff2') format('woff2');
            font-weight: bold;
        }

        @font-face {
            font-family: 'PP Neue Montreal';
            src: url('PPNeueMontreal-Regular.woff2') format('woff2');
            font-weight: normal;
        }

        body {
            background-color: #101010;
            color: #F8F8F8;
            font-family: 'PP Neue Montreal', sans-serif;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        .card {
            background: #101010;
            padding: 40px;
            border: 2px solid #ED8FFF;
            box-shadow: 0 0 20px rgba(237, 143, 255, 0.15);
            width: 90%;
            max-width: 900px;
            position: relative;
        }

        /* Refresh Timer Progress Bar */
        .timer-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.05);
        }

        #progressBar {
            height: 100%;
            background: #ED8FFF;
            width: 100%;
            box-shadow: 0 0 10px #ED8FFF;
        }

        .header {
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-container img {
            height: 24px;
            display: block;
        }

        .stats-display {
            font-family: 'PP Neue Bit', monospace;
            font-size: 28px; /* Bit font usually needs a larger size for legibility */
            color: #D6E6F4;
            letter-spacing: 1px;
            margin-top: 10px;
            text-shadow: 0 0 5px rgba(214, 230, 244, 0.3);
        }

        .terminal-label {
            font-family: 'PP Neue Bit', monospace;
            color: #ED8FFF;
            font-size: 18px;
            border: 1px solid #ED8FFF;
            padding: 2px 10px;
            text-transform: uppercase;
        }

        canvas {
            width: 100%;
            height: 380px;
            display: block;
            cursor: crosshair;
        }
    </style>
</head>
<body>

<div class="card">
    <div class="timer-container">
        <div id="progressBar"></div>
    </div>
    <div class="header">
        <div>
            <div class="logo-container">
                <img src="URnetwork-logo-light.svg" alt="URnetwork">
            </div>
            <div id="stats" class="stats-display">FETCHING_DATA...</div>
        </div>
        <div class="terminal-label">LIVE_NODE</div>
    </div>
    <canvas id="customChart"></canvas>
</div>

<script>
    const canvas = document.getElementById('customChart');
    const ctx = canvas.getContext('2d');
    const statsEl = document.getElementById('stats');
    const progressBar = document.getElementById('progressBar');

    const REFRESH_INTERVAL = 30000;
    let lastFetchTime = Date.now();
    let cachedData = null;
    let cachedChanges = null;

    const COLORS = {
        glow: '#ED8FFF',
        bars: '#D6E6F4',
        text: '#F8F8F8',
        bg: '#101010'
    };

    async function updateData() {
        try {
            const response = await fetch('https://api.bringyour.com/stats/last-90');
            const json = await response.json();
            const data = json.network_data;
            
            cachedData = data.map(d => d.count);
            cachedChanges = cachedData.map((v, i) => i === 0 ? 0 : v - cachedData[i-1]);
            
            lastFetchTime = Date.now();
            render();
            
            const lastVal = cachedData[cachedData.length - 1];
            const lastChange = cachedChanges[cachedChanges.length - 1];
            statsEl.innerText = `TOTAL: ${lastVal} // CHANGE: ${lastChange >= 0 ? '+' : ''}${lastChange}`;
        } catch (e) {
            statsEl.innerText = "LINK_ERROR: RETRYING...";
        }
    }

    function render() {
        if (!cachedData) return;

        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr;
        canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);

        const w = rect.width;
        const h = rect.height;
        const pad = 50;
        const chartW = w - (pad * 2);
        const chartH = h - (pad * 2);

        const maxVal = Math.max(...cachedData);
        const minVal = Math.min(...cachedData);
        const maxChange = Math.max(...cachedChanges.map(Math.abs));

        const getX = (i) => pad + (i * (chartW / (cachedData.length - 1)));
        const getY = (val) => (pad + chartH) - ((val - minVal) / (maxVal - minVal)) * chartH;

        ctx.clearRect(0, 0, w, h);

        // 1. Grid & Borders (Square Block Feel)
        ctx.strokeStyle = COLORS.text;
        ctx.globalAlpha = 0.05;
        ctx.lineWidth = 1;
        ctx.strokeRect(pad, pad, chartW, chartH);
        
        // 2. Daily Change Bars (D6E6F4)
        ctx.fillStyle = COLORS.bars;
        ctx.globalAlpha = 0.2;
        cachedData.forEach((_, i) => {
            const barH = (Math.abs(cachedChanges[i]) / (maxChange || 1)) * (chartH * 0.3);
            const barW = (chartW / cachedData.length) * 0.5;
            ctx.fillRect(getX(i) - barW/2, (pad + chartH) - barH, barW, barH);
        });

        // 3. History Curve (ED8FFF with Glow)
        ctx.globalAlpha = 1.0;
        ctx.shadowBlur = 12;
        ctx.shadowColor = COLORS.glow;
        ctx.strokeStyle = COLORS.glow;
        ctx.lineWidth = 3;
        ctx.lineJoin = 'round';
        ctx.beginPath();
        for (let i = 0; i < cachedData.length; i++) {
            const x = getX(i);
            const y = getY(cachedData[i]);
            if (i === 0) ctx.moveTo(x, y);
            else {
                const prevX = getX(i - 1);
                const prevY = getY(cachedData[i - 1]);
                ctx.bezierCurveTo(prevX + (x - prevX)/2, prevY, prevX + (x - prevX)/2, y, x, y);
            }
        }
        ctx.stroke();
        ctx.shadowBlur = 0;

        // 4. Axis Labels (PP Neue Montreal)
        ctx.fillStyle = COLORS.text;
        ctx.globalAlpha = 0.6;
        ctx.font = '11px PP Neue Montreal';
        ctx.textAlign = 'right';
        ctx.fillText(maxVal, pad - 12, getY(maxVal) + 4);
        ctx.fillText(minVal, pad - 12, getY(minVal) + 4);
        
        ctx.textAlign = 'center';
        ctx.fillText('HISTORY_90D', pad + chartW/2, pad + chartH + 25);
    }

    function animateTimer() {
        const elapsed = Date.now() - lastFetchTime;
        const progress = Math.max(0, 1 - (elapsed / REFRESH_INTERVAL));
        progressBar.style.width = (progress * 100) + "%";
        
        if (elapsed >= REFRESH_INTERVAL) {
            updateData();
        }
        requestAnimationFrame(animateTimer);
    }

    // Initial load
    updateData();
    animateTimer();
    
    // Resize handling
    window.addEventListener('resize', () => {
        render();
    });
</script>

</body>
</html>